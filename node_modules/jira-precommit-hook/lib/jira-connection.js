'use strict';

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.getJiraAPI = undefined;

var _regenerator = require('babel-runtime/regenerator');

var _regenerator2 = _interopRequireDefault(_regenerator);

var _objectWithoutProperties2 = require('babel-runtime/helpers/objectWithoutProperties');

var _objectWithoutProperties3 = _interopRequireDefault(_objectWithoutProperties2);

var _asyncToGenerator2 = require('babel-runtime/helpers/asyncToGenerator');

var _asyncToGenerator3 = _interopRequireDefault(_asyncToGenerator2);

var _getPrototypeOf = require('babel-runtime/core-js/object/get-prototype-of');

var _getPrototypeOf2 = _interopRequireDefault(_getPrototypeOf);

var _classCallCheck2 = require('babel-runtime/helpers/classCallCheck');

var _classCallCheck3 = _interopRequireDefault(_classCallCheck2);

var _createClass2 = require('babel-runtime/helpers/createClass');

var _createClass3 = _interopRequireDefault(_createClass2);

var _possibleConstructorReturn2 = require('babel-runtime/helpers/possibleConstructorReturn');

var _possibleConstructorReturn3 = _interopRequireDefault(_possibleConstructorReturn2);

var _get2 = require('babel-runtime/helpers/get');

var _get3 = _interopRequireDefault(_get2);

var _inherits2 = require('babel-runtime/helpers/inherits');

var _inherits3 = _interopRequireDefault(_inherits2);

// Grabs data from files and returns a JIRA connection object wrapped in promise
var getJiraAPI = exports.getJiraAPI = function () {
  var _ref = (0, _asyncToGenerator3.default)(_regenerator2.default.mark(function _callee(configPath) {
    var _ref2, projectName, config, jiraClient;

    return _regenerator2.default.wrap(function _callee$(_context) {
      while (1) {
        switch (_context.prev = _context.next) {
          case 0:
            _context.next = 2;
            return (0, _jiraConfiguration.getAPIConfig)(configPath);

          case 2:
            _ref2 = _context.sent;
            projectName = _ref2.projectName;
            config = (0, _objectWithoutProperties3.default)(_ref2, ['projectName']);
            jiraClient = new OurJiraApi(config);


            jiraClient.projectName = projectName;
            return _context.abrupt('return', jiraClient);

          case 8:
          case 'end':
            return _context.stop();
        }
      }
    }, _callee, this);
  }));

  return function getJiraAPI(_x) {
    return _ref.apply(this, arguments);
  };
}();

var _jiraConfiguration = require('./jira-configuration.js');

var _jiraClient = require('jira-client');

var _jiraClient2 = _interopRequireDefault(_jiraClient);

var _lodash = require('lodash');

var _lodash2 = _interopRequireDefault(_lodash);

function _interopRequireDefault(obj) { return obj && obj.__esModule ? obj : { default: obj }; }

var OurJiraApi = function (_JiraApi) {
  (0, _inherits3.default)(OurJiraApi, _JiraApi);

  function OurJiraApi() {
    (0, _classCallCheck3.default)(this, OurJiraApi);
    return (0, _possibleConstructorReturn3.default)(this, (OurJiraApi.__proto__ || (0, _getPrototypeOf2.default)(OurJiraApi)).apply(this, arguments));
  }

  (0, _createClass3.default)(OurJiraApi, [{
    key: 'findIssue',
    value: function findIssue(issueNumber) {
      if (!this._findIssueCache) {
        this._findIssueCache = _lodash2.default.memoize((0, _get3.default)(OurJiraApi.prototype.__proto__ || (0, _getPrototypeOf2.default)(OurJiraApi.prototype), 'findIssue', this));
      }

      return this._findIssueCache(issueNumber);
    }
  }]);
  return OurJiraApi;
}(_jiraClient2.default);